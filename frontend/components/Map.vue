<template>
  <div class="button"></div>
  <!-- Balise vide pour insérer la map -->
  <div class="map" id="map"></div>
  <button
    v-if="currentMapType !== 'generalZone'"
    class="SwitchButton"
    @click="goBack">
    Retour
  </button>
  <pre>{{ currentMapType }}</pre>
  <!-- Ce qui permet de faire apparaitre le nom du lieu en hover -->
  <div class="hoverName" id="hoverName"></div>
</template>

<script setup>
import { onMounted } from "vue";
import "ol/ol.css";
import Map from "ol/Map.js";
import View from "ol/View.js";
import ImageLayer from "ol/layer/Image.js";
import ImageStatic from "ol/source/ImageStatic.js";
import Feature from "ol/Feature.js";
import Polygon from "ol/geom/Polygon.js";
import { Style, Fill, Stroke } from "ol/style.js";
import { addProjection } from "ol/proj.js";
import Projection from "ol/proj/Projection.js";
import VectorSource from "ol/source/Vector.js";
import VectorLayer from "ol/layer/Vector.js";
import router from "@/router";
import { defaults as defaultInteractions } from "ol/interaction.js";
import { ref } from "vue";

let map;
const currentMapType = ref("generalZone");
let coucheVecteur = null;
let hoverStyle = null;
let defaultStyle = null;
let providerStyle = null;
let providerHoverStyle = null;
let generalStyle = null;
let generalHoverStyle = null;
let standStyle;
let standHoverStyle;
let lastFeature = null;
let label = null;
const tailleMap = [0, 0, 1000, 800];
const projection = new Projection({
  code: "MintonetteMap",
  units: "pixels",
  extent: tailleMap,
});

const generalMap = [
  {
    type: "generalZone",
    name: "Gymnase",
    image: "/mapTerrain.png",
    coord: [
      [0.3767253009857614, 785.6149619956983],
      [12.561064665646501, 789.7267995194851],
      [24.74540403030724, 791.2497024136545],
      [36.92974339496797, 792.6203144374657],
      [47.28643650288621, 792.772605307824],
      [62.51686070871214, 791.7065721200227],
      [78.50880612482935, 790.6405403845747],
      [97.69914992008322, 788.5084740089721],
      [149.20096347906286, 781.7586668459915],
      [209.71400164633175, 770.8673262906526],
      [260.948361649877, 760.3793436423458],
      [310.5690652584465, 750.6981614412872],
      [321.0580164969249, 747.8744906726571],
      [326.70590621490794, 745.0508122101014],
      [331.1435228581364, 740.2102095686835],
      [332.35376515436803, 732.9493133004822],
      [330.6896627604728, 728.7137879127231],
      [328.1682861701699, 719.6376637305086],
      [320.44119043410905, 688.9891735644276],
      [311.0148429701772, 677.0950971803645],
      [282.2865821026694, 677.6748993142118],
      [272.71008917106275, 668.6977511035947],
      [271.51304467873206, 659.1221468926647],
      [271.51304467873206, 633.387659921576],
      [266.72477538076856, 621.4181289740865],
      [246.37469936090426, 621.4181289740865],
      [233.20702728798517, 607.0546827050716],
      [166.7700533485838, 549.0024530437339],
      [169.1641879975655, 531.0481566224996],
      [102.72716839384383, 481.3746077564319],
      [78.78591323266747, 446.6629383296228],
      [60.231449615619596, 455.0415962948244],
      [51.25347893017829, 446.6629383296228],
      [47.06377754270048, 432.89795947595513],
      [43.472552737067744, 414.9436630547209],
      [0.9768339588430734, 396.9893666334866],
      [0.3767253009857614, 785.6149619956983],
    ],
  },
  {
    type: "generalZone",
    name: "Zone prestataire",
    image: "/MapPresta.png",
    coord: [
      [281.4211249888716, 676.4865475306182],
      [356.232304219938, 676.4865475306182],
      [358.26795087046685, 636.2855783975851],
      [405.0885615545801, 636.2855783975851],
      [403.5617877392125, 668.3445806957978],
      [407.6331586952123, 676.4865475306182],
      [487.53349338007183, 676.4865475306182],
      [490.0780905207039, 635.2678483154477],
      [547.1191628719403, 634.292206895531],
      [548.6459366873079, 676.0197711517702],
      [631.5997801754318, 678.564135181028],
      [634.1443773160638, 665.8423150347394],
      [635.1622394687993, 626.1502206487536],
      [635.6285155258869, 635.4477943808158],
      [670.7439638321041, 634.4300448867214],
      [681.4312640572647, 677.6842333841023],
      [755.7334927982279, 677.6842333841023],
      [765.402969698124, 666.9978831080672],
      [762.3494608948597, 625.270338263785],
      [791.3578527670772, 624.7614538107592],
      [804.58975013287, 608.9864045941442],
      [803.9262989138572, 549.8521344439976],
      [848.7111852924995, 542.2190423562243],
      [860.4163476703957, 524.9173980164032],
      [852.2736445858667, 467.0399903661456],
      [867.032276939556, 439.0519860443108],
      [906.219096201773, 439.56085108537957],
      [923.5223645235656, 409.0284827342871],
      [923.5223645235656, 396.81552762906733],
      [932.1739792707262, 391.21793452948316],
      [927.0847849894622, 355.5968381198753],
      [916.9063964269337, 362.21218071355395],
      [908.7636933424046, 314.3934964164375],
      [912.8350642984044, 340.3460211620403],
      [932.1739792707258, 309.30476835792206],
      [868.050139092291, 309.8136528109478],
      [857.8717505297626, 334.7484086504991],
      [847.6933619672343, 338.31052217385127],
      [839.0417472200735, 333.2217941153359],
      [828.8633586575451, 317.95560993978967],
      [827.3365848421774, 309.30476835792206],
      [769.8287127603745, 308.28701886382754],
      [767.7930272823746, 330.1685650450095],
      [759.6503241978462, 339.83713670901454],
      [747.94516181995, 344.4169997264612],
      [738.784596582686, 335.7661581445936],
      [730.6418934981575, 325.079836986494],
      [723.0081020762613, 312.86688188127425],
      [725.5526992168934, 304.21604029940664],
      [731.1508051607898, 293.52971914130705],
      [651.4840975158406, 294.25047923114937],
      [646.9038537246796, 315.6231409593055],
      [640.2878856280478, 324.78284758224186],
      [626.0381261095196, 326.309462117405],
      [617.3865113623589, 319.6941195237264],
      [611.2794937558302, 301.88357131892246],
      [609.2438082778303, 293.23272973705485],
      [562.9321480838203, 291.19725016082293],
      [435.8262503802048, 296.1929728495372],
      [435.14593158664604, 324.7641597634173],
      [422.8999856826018, 345.1721652448293],
      [403.170429239418, 342.4511134173802],
      [390.24421644681195, 327.4852375409872],
      [390.24421644681195, 305.7166931707903],
      [390.24421644681195, 292.1113561831823],
      [324.2522553716797, 295.51269043008426],
      [329.0145907365844, 315.9206959114963],
      [325.61294486379404, 329.5260328991043],
      [315.40800724542277, 345.1721652448293],
      [295.67845080223896, 351.29457726930127],
      [289.55547785021685, 332.2471106766742],
      [282.2209158023592, 319.32203015839843],
      [280.8602263102449, 300.9548200351034],
      [289.02420754793997, 284.62843122004637],
      [223.71256526636648, 298.2337682076544],
      [214.86831714010953, 329.5260328991044],
      [198.54040656971614, 339.73003563981035],
      [186.29446066567192, 327.4852375409874],
      [184.25350428499576, 307.7574885289074],
      [191.0567960305766, 290.7508172943974],
      [148.19603727141862, 294.8324339607524],
      [144.11407260506948, 319.32203015839843],
      [132.5484973995808, 332.9273671460064],
      [115.54026803562871, 332.9273671460064],
      [105.33533041725745, 317.28123480028137],
      [103.97464092514318, 292.1113561831824],
      [133.44551954533327, 361.27314940035023],
      [124.01955403559425, 354.71657166135503],
      [120.74098044701479, 387.08971137391524],
      [129.75709689947482, 389.9582043646541],
      [127.29815889126691, 408.3985890256494],
      [142.87145378797908, 439.9521604288638],
      [179.31789897169398, 439.48880109830293],
      [192.43228712729143, 459.5683223779899],
      [190.38316690926933, 473.5010774295547],
      [183.00632161755243, 468.58364412530835],
      [178.08844560113658, 498.90784352436106],
      [185.46525962576032, 502.59590482444577],
      [182.59650382736663, 516.1188679052805],
      [194.77755284857514, 540.5771875293478],
      [236.16977499920318, 540.1674072827036],
      [241.087651015619, 553.6903586394525],
      [237.8090774270395, 565.5741577453955],
      [230.43223213532266, 562.2958688758979],
      [226.3339916992784, 586.473278598657],
      [234.53047257136686, 587.2928469080027],
      [234.1206547811811, 600.406002385993],
      [243.5466202909201, 618.4366224324585],
      [281.4211249888716, 676.4865475306182],
    ],
  },
];
//Terrains & Gradins #############################################################################################################################################
const landLocations = [
  {
    type: "court",
    name: "Terrain 1",
    coord: [
      [222, 375],
      [480, 375],
      [480, 517],
      [228, 517],
      [222, 375],
    ],
  },
  {
    type: "court",
    name: "Terrain 2",
    coord: [
      [525, 375],
      [775, 375],
      [771, 517],
      [525, 517],
      [525, 375],
    ],
  },
  {
    type: "court",
    name: "Terrain 3",
    coord: [
      [210, 180],
      [478, 180],
      [478, 340],
      [220, 340],
      [210, 180],
    ],
  },
  {
    type: "court",
    name: "Terrain 4",
    coord: [
      [525, 180],
      [783, 180],
      [775, 339],
      [525, 340],
      [525, 180],
    ],
  },
  // Gradin ##############################################################################################################################################################################################################################
  {
    type: "stand",
    name: "Tribune Nord (VIP)",
    image: "/GradinNord.png",
    coord: [
      [132.5845215002734, 732.9238507783072],
      [167.24812135453584, 672.6067166865045],
      [179.72698704759483, 673.9933020882194],
      [228.94927324070667, 564.4518043944902],
      [483.380103152795, 564.4518043944902],
      [764.5558460235761, 563.9711973921046],
      [816.2140429569015, 669.4902245104562],
      [823.5414561539803, 670.9557650590579],
      [860.1784452718397, 733.9740816761296],
      [809.9857279032286, 738.3707033219347],
      [730.0671784422435, 742.4009513611995],
      [646.9011324337919, 744.5992621841021],
      [569.5970046841975, 746.431191713391],
      [471.94756142796746, 747.3352991104914],
      [382.91958178715123, 748.0680693847922],
      [312.9428595478822, 746.2361475425768],
      [241.1662147920025, 744.7287980731859],
      [144.81083732761462, 739.5994061530796],
      [129.7896602591622, 738.8666205046319],
      [132.5845215002734, 732.9238507783072],
    ],
  },
  {
    type: "stand",
    name: "Tribune Est",
    image: "/GradinEst.png",
    coord: [
      [1000.0183533690831, 563.7368703178712],
      [845.7201416903512, 532.6818601683672],
      [862.2173784196098, 318.2079825300115],
      [856.3947859543684, 279.3891791205899],
      [834.0749160390214, 250.275086744159],
      [837.1471498206777, 241.25638461367993],
      [872.489882445946, 215.19971214382684],
      [876.3595349761905, 223.45528553792428],
      [876.8755030803716, 233.51678996949448],
      [886.1626258525132, 230.16295515897104],
      [907.8326367214371, 229.64698723462084],
      [929.4106132604873, 233.85331305400473],
      [950.8303377945967, 243.43623136537997],
      [966.88808979894, 226.74655932233838],
      [989.3909252088789, 214.33064815373294],
      [1000.2454382866972, 212.21209524462427],
      [1000.0183533690831, 563.7368703178712],
    ],
  },
  {
    type: "stand",
    name: "Tribune Sud",
    image: "/GradinSud.png",
    coord: [
      [1.3940538722077065, 127.19543376205678],
      [119.24098613019876, 210.46032043704224],
      [174.82432977976896, 164.74090649206778],
      [220.1600915998898, 143.36741533023297],
      [299.17384480905645, 132.3568602697443],
      [371.06343366345766, 133.0045335844166],
      [682.7334074856001, 129.93795904710475],
      [773.4473907994039, 139.43165991944085],
      [840.1733009552373, 180.1980001001819],
      [849.1209198626013, 167.54741410411157],
      [851.8977697883565, 150.8856471157903],
      [850.0465106109718, 135.76664304351266],
      [842.0245342390739, 121.264746727115],
      [856.21727959258, 114.7851865005942],
      [868.5588175557959, 106.45429005912106],
      [882.1345196727532, 91.33528598684336],
      [888.3052886543613, 78.06759223489308],
      [891.3906601983917, 66.03411399470272],
      [912.9883127936989, 67.26830361183767],
      [932.4262104868945, 63.87425627009168],
      [946.3104212753524, 57.39468956991466],
      [965.4397844034997, 45.669752260351785],
      [981.4837630408431, 59.55454729452575],
      [1000.3045916039422, 67.2683165591502],
      [999.6875224738455, 0.6213133424275838],
      [60.111095940223734, -0.304315923111119],
      [43.450035226010115, 10.494972699944356],
      [28.02312571876338, 23.454106100298418],
      [12.287681646468357, 37.64745501241235],
      [-0.36237793502256466, 52.76645261103374],
      [1.3940538722077065, 127.19543376205678],
    ],
  },
  {
    type: "stand",
    name: "Tribune Ouest",
    image: "/GradinOuest.png",
    coord: [
      [1.2260519895663151, 571.3909687696703],
      [144.1661909878266, 531.0974317682259],
      [127.85760721908105, 320.03603693150797],
      [126.54472976011627, 303.82182779624173],
      [129.74842779109676, 291.0065360120683],
      [136.68975485375213, 279.79314869894927],
      [143.89807542345827, 270.18167706003226],
      [152.17425799455307, 258.9683009500609],
      [150.03846677568694, 252.5606550579741],
      [103.58496855596555, 221.32338343464153],
      [91.83810564952088, 212.24587621836014],
      [-0.010475320549097944, 154.83459317185364],
      [1.2260519895663151, 571.3909687696703],
    ],
  },
];

// Gradins  ##########################################################################################################################################################################################################################################
const NorthStand = [
  {
    type: "stand",
    name: "PrixCher",
    url: "../PrixCher",
    coord: [
      [197.24300002303798, 116.1750271862619],
      [865.2774427711763, 106.96035246067026],
      [931.3129821821058, 424.865857169274],
      [619.5636099348471, 435.6162895345668],
      [390.74260149499014, 440.2235946755164],
      [131.20733173008654, 437.15201495242155],
      [197.24300002303798, 116.1750271862619],
    ],
  },
  {
    type: "stand",
    name: "PrixPasCher",
    url: "../PrixPasCher",
    coord: [
      [71.3409777832273, 633.9786521287269],
      [125.84305712384845, 433.4803333811623],
      [931.6960061781832, 427.6405206158932],
      [982.3052023694979, 626.1922759493611],
      [723.4200192068453, 665.1239934822174],
      [608.5763316051754, 670.9637245655003],
      [540.4485486525774, 672.9103696615832],
      [448.9628133754436, 678.7501415858593],
      [384.7281586079139, 678.7501415858593],
      [277.6704006620311, 678.7501415858593],
      [149.2011728055591, 665.1239934822174],
      [69.21194389795662, 650.8896410092548],
      [71.3409777832273, 633.9786521287269],
    ],
  },
];

const EstStand = [
  {
    type: "stand",
    name: "PrixCher",
    url: "../PrixCher",
    coord: [
      [176.2836981541086, 519.054598490954],
      [649.6104307988468, 581.7034056617854],
      [734.8788253861468, 576.4826595602901],
      [766.2019985249719, 557.3399725371781],
      [807.9660833357045, 531.2363150532578],
      [835.8088065428594, 508.61310628796366],
      [845.4884817662023, 497.89978584667733],
      [848.9688281811249, 462.2247232047992],
      [849.8389421675968, 438.2963230777052],
      [847.6636937117387, 416.97828225616297],
      [846.4152385574275, 390.86777720478256],
      [844.0825819424379, 357.4316519258961],
      [807.5377153137485, 266.4545355451752],
      [767.1051094116137, 318.55255979132727],
      [745.3336911747847, 344.2128013859724],
      [728.2275861679349, 353.5437671839371],
      [708.0112505895615, 359.7644545541319],
      [691.6827195392457, 358.2092908687491],
      [667.5787099420388, 358.2092908687491],
      [663.3005712437969, 328.3010299429247],
      [217.3392274778982, 283.07923971076605],
      [176.2836981541086, 519.054598490954],
    ],
  },
  {
    type: "stand",
    name: "PrixPasCher",
    url: "../PrixPasCher",
    coord: [
      [129.90687999905307, 803.8515706700118],
      [169.68670075878504, 528.2237127953586],
      [649.8841346100088, 585.0541971112393],
      [689.6638361396125, 576.5296632152614],
      [715.3252597226889, 569.3370448904197],
      [738.7668567779774, 555.1294387158358],
      [765.0498270196294, 542.3425484455515],
      [789.2017971790409, 524.5830183707424],
      [814.0640808275111, 489.77436088643225],
      [831.8228718950082, 469.88368243324226],
      [843.188483870591, 447.8618854104441],
      [852.4230957639331, 432.943906379324],
      [851.002349555687, 497.58855173464656],
      [845.3195435678958, 530.2660906493484],
      [838.2160509869225, 569.3370448904197],
      [822.5883196167302, 606.9872385140328],
      [814.7744539316341, 626.1675292063005],
      [848.3872822325179, 660.4166984713595],
      [860.9840817964853, 695.0593057795965],
      [876.7301803608036, 726.5526482229377],
      [889.326979924771, 783.2407207852596],
      [892.4626851440032, 801.2505423310827],
      [129.90687999905307, 803.8515706700118],
    ],
  },
];

const SouthStand = [
  {
    type: "stand",
    name: "PrixPasCher",
    url: "../PrixPasCher",
    coord: [
      [104.82777916200078, 677.7304861903494],
      [175.94737474596255, 499.9244375117187],
      [206.65790264532072, 459.51399348445597],
      [248.68323536959306, 415.87064746393986],
      [314.9534932361298, 398.0900425960768],
      [279.39376326895126, -1.165332954076007],
      [53.10458490050641, -2.7817330799840647],
      [24.010322040817016, 69.95708651737618],
      [1.3813906390120678, 147.5451743200856],
      [-5.084076468477065, 435.26772028533577],
      [104.82777916200078, 677.7304861903494],
    ],
  },
  {
    type: "stand",
    name: "PrixCher",
    url: "../PrixCher",
    coord: [
      [318.6920824648939, 421.088332880612],
      [677.9478983264328, 417.27979907337374],
      [721.5780027057792, 1.3023276266873154],
      [279.9184339521871, 2.8686752154718533],
      [318.6920824648939, 421.088332880612],
    ],
  },
  {
    type: "stand",
    name: "PrixPasCher",
    url: "../PrixPasCher",
    coord: [
      [688.29094927702, 393.4628795562422],
      [737.1463528644142, 403.82652175911016],
      [774.1580335438689, 431.9566118647797],
      [799.3259913153839, 467.48929023133127],
      [815.6111258445154, 503.0219375351612],
      [840.7789593703143, 557.8015131187032],
      [847.2560128076475, 580.934776161769],
      [853.9181302394352, 526.8954873607648],
      [851.6974244288392, 479.51856216354827],
      [850.2169745960614, 443.2456436085414],
      [839.8537015208997, 408.45322096180587],
      [854.6583862172533, 381.0634487013957],
      [865.7322139998934, 352.797961098832],
      [876.9994412939236, 315.6150743869625],
      [884.8862545514512, 278.4321640348503],
      [889.393126557656, 248.0098193725882],
      [887.1397378330716, 218.71421595843213],
      [910.8006503908342, 218.71421595843213],
      [931.0812434691302, 204.06643789159682],
      [946.8551536552932, 188.29182401568454],
      [960.3756751168719, 154.48920832861876],
      [963.7558054822666, 135.3343707083883],
      [973.8961965784506, 172.51730470074318],
      [980.6563627522039, 193.92557753670036],
      [994.1768842137825, 213.08046243741632],
      [1000.9371449445719, 2.377437736822685],
      [719.2603394322928, 0.12390796012527971],
      [688.29094927702, 393.4628795562422],
    ],
  },
];

const WestStand = [
  {
    type: "stand",
    name: "PrixCher",
    url: "../PrixCher",
    coord: [
      [839.6821741164738, 482.92883322719194],
      [801.1279840049184, 242.69693902852543],
      [399.2753409262989, 316.8426115054865],
      [347.3754552631474, 318.3255075318841],
      [314.75272687869, 297.56471426029464],
      [296.9585905890613, 257.5260859690187],
      [270.26719948586924, 221.93614575693573],
      [202.0561985221546, 402.8515144191345],
      [231.71313382014657, 474.0313948433005],
      [270.26719948586924, 525.9333469095216],
      [332.5469876141514, 571.9036526446466],
      [379.9983080934376, 585.2498724459895],
      [408.17234684819687, 585.2498724459895],
      [405.2066782075642, 560.0403288697013],
      [839.6821741164738, 482.92883322719194],
    ],
  },
  {
    type: "stand",
    name: "PrixPasCher",
    url: "../PrixPasCher",
    coord: [
      [72.98403140543218, 785.9660750072215],
      [179.78904173433452, 447.4003020663923],
      [224.12317781939123, 509.8737759485066],
      [264.42681489940077, 564.2861700658598],
      [320.8521097569834, 600.5610712893711],
      [363.1711654608242, 618.698437336954],
      [397.4292231545708, 622.7290195014209],
      [397.08909551511084, 588.0103691005053],
      [414.3005327357872, 586.6863188336126],
      [414.3005327357872, 570.7982434287158],
      [838.9589837791252, 494.2538930170706],
      [882.6494910831271, 785.5360902859293],
      [72.98403140543218, 785.9660750072215],
    ],
  },
];
//Prestataires  #########################################################################################################""
const serviceLocation = [
  {
    name: "Stand de Burger",
    type: "service",
    coord: [
      [117.77873110791089, 309.03570203971947],
      [157.67369382565073, 309.03570203971947],
      [160.2568250040178, 314.4884635819816],
      [163.12696589166188, 323.3850918052233],
      [161.1178541318487, 328.55086993126156],
      [168.29320635095885, 335.1515870338502],
      [172.02439826387098, 339.4564039635014],
      [181.49585005463408, 337.1605037905639],
      [188.09718285519028, 329.6988145438725],
      [191.82837476810244, 322.23713624489676],
      [188.6712022737442, 317.9323193152456],
      [193.26344521192448, 318.50629709540885],
      [197.8556662526675, 314.77544699820544],
      [200.7258071403116, 310.47063006855427],
      [240.33373825133725, 306.4527856074114],
      [270.111002969252, 390.8994414843513],
      [233.0861811391562, 440.5483278834515],
      [117.7065262148399, 441.4093000275542],
      [98.47656912916241, 408.40570904075315],
      [100.1986492822615, 392.04740251853565],
      [91.0142072007754, 388.3165524213322],
      [96.46745736934936, 356.46091699485766],
      [106.22594076682658, 361.05271734073267],
      [117.77873110791089, 309.03570203971947],
    ],
    url: "../PrestatairePublic",
  },
  {
    name: "Presta 2",
    type: "service",
    coord: [
      [307.9317037685654, 310.11976363987276],
      [371.275246490315, 308.90952197862197],
      [370.06484777569585, 319.80200471885973],
      [376.5202665447071, 327.46707376610186],
      [374.9064118524543, 333.51845135629515],
      [380.55488788448014, 339.56982894648854],
      [390.2379544745611, 335.9390116260419],
      [393.11262833549307, 337.4518483288657],
      [392.9109003466762, 342.69638019053457],
      [397.34897766408295, 343.503225919059],
      [401.1818710150391, 343.09980690215906],
      [402.7957257072919, 337.4518483288657],
      [404.2078370198689, 334.426159533769],
      [410.23157525603847, 339.5267842173319],
      [416.3159141934283, 310.38867644460987],
      [464.6703536079556, 308.1473070286578],
      [468.5131055622645, 406.7685201777326],
      [468.5772580488963, 394.42047592535346],
      [449.0433483500898, 394.1002698248342],
      [446.16129049222457, 440.5290917287275],
      [317.1093776462652, 440.208897842822],
      [309.10367494745384, 415.2333899818608],
      [309.90600990830086, 396.51703846323034],
      [301.7157970065304, 391.1088981171114],
      [303.75344391849796, 359.2371352829622],
      [311.9436686101589, 364.954313399169],
      [307.9317037685654, 310.11976363987276],
    ],
    url: "../Presta2",
  },
  {
    name: "Presta 3",
    type: "service",
    coord: [
      [534.1303787730717, 395.2445885631331],
      [545.4411715797162, 395.9098594072795],
      [546.1065287559065, 407.8849312849484],
      [548.934226957568, 407.3028034347852],
      [550.9302477245769, 395.9930309520256],
      [556.4193238694373, 396.3256727187128],
      [557.2731362730683, 439.7804985272862],
      [687.9734941049084, 440.0445164724701],
      [695.6085583698215, 411.530686660663],
      [694.2883527351564, 394.3695856881143],
      [702.737660739117, 390.9373675078939],
      [700.6253236657573, 352.91890425877494],
      [692.4400527597818, 362.687553123409],
      [686.3670987824278, 318.33270954711065],
      [691.1198471251178, 321.764927727331],
      [699.5691551290784, 322.55697652715924],
      [705.6421091064333, 320.44484303713494],
      [709.0746316697189, 314.90048129544334],
      [708.8105945717336, 306.979973154267],
      [684.7828560497776, 305.65988846407095],
      [678.7099020724227, 309.09211671573826],
      [634.086947591796, 309.3561296251987],
      [629.3341992491064, 318.0686865662034],
      [626.165713783806, 314.63646838598305],
      [623.2612654164907, 324.933132998091],
      [615.3400316085005, 326.2532176882871],
      [609.2670776311454, 325.7251817979193],
      [605.5704978251355, 323.0850124175272],
      [601.6098809211403, 318.0686865662034],
      [599.2335067497954, 309.8841655155667],
      [566.4924231258937, 309.6201526061062],
      [564.3800860525339, 305.1318626451502],
      [552.7622724385336, 305.1318626451502],
      [552.4982353405484, 309.6201526061062],
      [539.2961789938979, 308.3000679159101],
      [534.1303787730717, 395.2445885631331],
    ],
    url: "../Presta3",
  },
  {
    name: "Presta 4",
    type: "service",
    coord: [
      [766.2539698519661, 305.97469961406233],
      [767.1073030416405, 312.23191571938827],
      [768.5295286413382, 315.64494663128465],
      [750.1123312319052, 365.38417052100573],
      [739.5014015556866, 391.7961686432256],
      [748.9835100253568, 391.7961686432256],
      [752.1442128485803, 403.53483543214935],
      [761.1747825009646, 396.76252866293567],
      [761.4005432973853, 390.6674508483566],
      [772.2372165455796, 390.6674508483566],
      [778.5586221920264, 428.59237133938336],
      [774.0433373658343, 433.55872274766],
      [777.6555617818991, 441.9112447634103],
      [841.7577154292738, 441.35646717855263],
      [897.521476142969, 440.9049783383184],
      [916.034137040579, 410.8810867170911],
      [914.5257186896287, 394.1520828305211],
      [923.1047495247269, 390.0886918798462],
      [917.2348826955661, 356.00142222509396],
      [908.6558518604678, 361.4192710850383],
      [905.0436274444024, 342.45680868666665],
      [915.6545398961761, 323.7200950141288],
      [919.9440639259475, 321.4626594243909],
      [923.3305275455916, 318.9794837202526],
      [924.0078099348536, 312.88440590567353],
      [923.3305275455916, 305.4348615703918],
      [860.3423007753224, 310.40122159010184],
      [862.8257039848392, 317.3992770851493],
      [856.504315562837, 320.1082015151215],
      [858.5361799550677, 325.300301649232],
      [852.8920739223275, 332.52409725867994],
      [847.6995067068734, 336.81321971232194],
      [842.0554006741332, 337.26470855255616],
      [835.5082342312656, 334.78153284841784],
      [832.7871989261901, 330.65550678226856],
      [828.9492137137046, 328.84956003276494],
      [829.8522741238319, 322.98023094401975],
      [825.3369892976398, 325.01191780792385],
      [823.3051076809644, 318.91684860477824],
      [819.6928832648996, 317.78813080990926],
      [821.724764881575, 308.9841285653581],
      [791.0208142839127, 307.62966204465533],
      [785.8564607088446, 307.12174678725444],
      [786.0822301174875, 311.63661366101354],
      [779.7608244710401, 311.4108606294632],
      [780.0994656656711, 306.8959894499874],
      [766.2539698519661, 305.97469961406233],
    ],
    url: "../Presta4",
  },
];

//Pour créer les zones sur les maps
function features(location) {
  return location.map((location) => {
    const feature = new Feature({
      geometry: new Polygon([location.coord]),
      name: location.name,
      type: location.type,
      url: location.url,
      image: location.image,
    });
    return feature;
  });
}

onMounted(() => {
  //Création d'une nouvelle projection
  addProjection(projection);

  //Création d'une "couche" en gros ce qu'on l'on va afficher (une image fixe)
  const mapLayer = new ImageLayer({
    source: new ImageStatic({
      url: "/MapTout.jpeg",
      projection: projection,
      imageExtent: tailleMap,
    }),
  });

  map = new Map({
    target: "map",
    layers: [mapLayer],
    view: new View({
      projection,
      center: [500, 400],
      minZoom: 1,
      maxZoom: 1,
      zoom: 1,
    }),
    interactions: defaultInteractions({
      //Enleve tous
      dragPan: false, //Déplacement
      mouseWheelZoom: false, // Zoom molette
      doubleClickZoom: false, // Désactive le zoom double clic
      pinchZoom: false, // Désactive le zoom tactile
      keyboard: false,
    }),
  });

  //On ajoute les tableaux des coordonnées
  const featuresList = features(generalMap);

  //Style hover et normal
  hoverStyle = new Style({
    stroke: new Stroke({ color: "#ffffff", width: 2 }),
    fill: new Fill({ color: "rgba(0,22,122,0.3)" }),
  });
  defaultStyle = new Style({
    stroke: new Stroke({ color: "#00167a", width: 2 }),
    fill: new Fill({ color: "rgba(0,22,122,0.5)" }),
  });
  standStyle = new Style({
    stroke: new Stroke({ color: "#000000", width: 2 }),
    fill: new Fill({ color: "rgba(0,0,0,0.3)" }),
  });
  standHoverStyle = new Style({
    stroke: new Stroke({ color: "#000000", width: 2 }),
    fill: new Fill({ color: "rgba(0,0,0,0.5)" }),
  });
  providerStyle = new Style({
    stroke: new Stroke({ color: "#1F5E00", width: 2 }),
    fill: new Fill({ color: "rgba(31,94,0,0.6)" }),
  });
  providerHoverStyle = new Style({
    stroke: new Stroke({ color: "#2E8B00", width: 2 }),
    fill: new Fill({ color: "rgba(68,172,16,0.7)" }),
  });
  generalStyle = new Style({
    stroke: new Stroke({ color: "#CC3300", width: 2 }),
    fill: new Fill({ color: "rgba(204,51,0,0.4)" }),
  });
  generalHoverStyle = new Style({
    stroke: new Stroke({ color: "#FF6600", width: 2 }),
    fill: new Fill({ color: "rgba(255,102,0,0.6)" }),
  });

  featuresList.forEach((f) => {
    if (f.get("type") === "stand") f.setStyle(standStyle);
    else if (f.get("type") === "service") f.setStyle(providerStyle);
    else if (f.get("type") === "generalZone") f.setStyle(generalStyle);
    else f.setStyle(defaultStyle);
  });

  const sourceVecteur = new VectorSource({ features: featuresList });
  coucheVecteur = new VectorLayer({ source: sourceVecteur });
  map.addLayer(coucheVecteur);

  // Hover name
  lastFeature = null;
  label = document.getElementById("hoverName");
  map.on("pointermove", (event) => {
    const searchFeature = map.forEachFeatureAtPixel(
      event.pixel,
      (featureFound) => featureFound
    );
    const mapElement = document.getElementById("map");

    //Permet de remettre la bonne couleur quand on part du polygone
    if (searchFeature !== lastFeature) {
      if (lastFeature) {
        if (lastFeature.get("type") === "stand")
          lastFeature.setStyle(standStyle);
        else if (lastFeature.get("type") === "service")
          lastFeature.setStyle(providerStyle);
        else if (lastFeature.get("type") === "generalZone")
          lastFeature.setStyle(generalStyle);
        else lastFeature.setStyle(defaultStyle);
      }
    }

    if (searchFeature) {
      const name = searchFeature.get("name");
      const pixel = event.originalEvent;
      label.style.display = "block";
      label.style.left = pixel.pageX + 8 + "px";
      label.style.top = pixel.pageY - 25 + "px";
      label.innerText = name;
      mapElement.style.cursor = "pointer";
      label.style.fontSize = "12px";
      label.style.padding = "2px 6px";
      if (searchFeature.get("type") === "stand") {
        searchFeature.setStyle(standHoverStyle);
        label.style.backgroundColor = "#000000";
      } else if (searchFeature.get("type") === "service") {
        searchFeature.setStyle(providerHoverStyle);
        label.style.backgroundColor = "#1F5E00";
      } else if (searchFeature.get("type") === "generalZone") {
        searchFeature.setStyle(generalHoverStyle);
        label.style.backgroundColor = "#FF6600";
      } else {
        searchFeature.setStyle(hoverStyle);
        label.style.backgroundColor = "#00167a";
      }
    } else {
      mapElement.style.cursor = "default";
      label.style.display = "none";
    }
    lastFeature = searchFeature;
  });

  // Gestion du clic
  map.on("click", (event) => {
    const clickedFeature = map.forEachFeatureAtPixel(
      event.pixel,
      (featureFound) => featureFound
    );
    if (!clickedFeature) return;

    const type = clickedFeature.get("type");

    if (type === "stand") {
      // Récupère l'image du gradin
      const image = clickedFeature.get("image");
      currentMapType.value = "stand";
      // Appelle changeMap avec cette image
      changeMap("stand", image);
    } else if (type === "generalZone") {
      const image = clickedFeature.get("image");

      // Déterminer le type réel de la zone en fonction de l'image
      if (image === "/mapTerrain.png") {
        currentMapType.value = "terrains";
      } else {
        currentMapType.value = "prestataires";
      }
      changeMap(currentMapType.value, image);
    } else {
      //Si c’est un terrain ou prestataire → redirection
      const url = clickedFeature.get("url");
      if (url) router.push(url);
    }
  });
});
function changeMap(type, image = null) {
  if (!map) return;
  currentMapType.value = type; //Pour mémoriser le type de carte actif

  // Supprime la couche de zones
  if (coucheVecteur) {
    map.removeLayer(coucheVecteur);
    coucheVecteur = null;
  }

  // Supprime la couche d'image actuelle
  const oldImageLayer = map.getLayers().item(0);
  if (oldImageLayer) map.removeLayer(oldImageLayer);

  // Définit l'image à afficher
  let imageUrl = "/MapTout.jpeg";
  if (type === "prestataires") imageUrl = "/MapPresta.png";
  if (type === "stand" && image) imageUrl = image;
  if (type === "generalZone" && image) imageUrl = image;
  if (type === "terrains") imageUrl = "/mapTerrain.png";

  // Ajoute la nouvelle image
  const newImageLayer = new ImageLayer({
    source: new ImageStatic({
      url: imageUrl,
      projection: projection,
      imageExtent: tailleMap,
    }),
  });
  map.getLayers().insertAt(0, newImageLayer);

  // Détermine quelle liste de zones afficher
  let zone = [];

  if (type === "generalZone") {
    if (!image || image === "/MapTout.jpeg") {
      zone = generalMap;
    } else if (image === "/mapTerrain.png") {
      zone = landLocations;
    } else if (image === "/MapPresta.png") {
      zone = serviceLocation;
    }
  } else if (type === "terrains") {
    zone = landLocations;
  } else if (type === "prestataires") {
    zone = serviceLocation;
  } else if (type === "stand") {
    if (image === "/GradinNord.png") zone = NorthStand;
    else if (image === "/GradinEst.png") zone = EstStand;
    else if (image === "/GradinSud.png") zone = SouthStand;
    else if (image === "/GradinOuest.png") zone = WestStand;
  }

  // Si aucune zone à afficher, on s'arrête ici
  if (zone.length === 0) return;

  // Crée les polygones pour chaque zone
  const featuresList = features(zone);
  featuresList.forEach((f) => {
    if (f.get("type") === "stand") f.setStyle(standStyle);
    else if (f.get("type") === "service") f.setStyle(providerStyle);
    else if (f.get("type") === "generalZone") f.setStyle(generalStyle);
    else f.setStyle(defaultStyle);
  });

  // Crée la couche vectorielle contenant les polygones
  const sourceVecteur = new VectorSource({ features: featuresList });
  coucheVecteur = new VectorLayer({ source: sourceVecteur });
  map.addLayer(coucheVecteur);
}

function goBack() {
  switch (currentMapType.value) {
    case "stand":
      changeMap("terrains", "/mapTerrain.png");
      break;
    case "terrains":
      changeMap("generalZone", "/MapTout.jpeg");
      break;
    case "prestataires":
      changeMap("generalZone", "/MapTout.jpeg");
      break;
    default:
      break;
  }
}
</script>

<style>
body {
  font-family: "Inter", "Segoe UI", sans-serif;
  background: #f9fafb;
  color: #222;
}

body::-webkit-scrollbar {
  display: none;
}

.button {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 20px 0;
}

.SwitchButton {
  cursor: pointer;
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  background: #e0e7ff;
  color: #00167a;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.25s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.SwitchButton:hover {
  background: #00167a;
  color: #fff;
  transform: translateY(-2px);
}

.map {
  height: 420px;
  width: 520px;
  margin: 0 auto;
  border: 2px solid #00167a;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.hoverName {
  display: none;
  z-index: 9999;
  position: absolute;
  padding: 6px 10px;
  background: #fff;
  border-radius: 6px;
  font-size: 13px;
  color: white;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}
</style>
